# 半双工与同步通讯、异步通讯的概念辨析

1 半双工的定义

在数据通信领域，数据传输方式可分为单工通信、半双工通信和全双工通信。半双工通信方式允许数据在两个方向上传输，但同一时间只能在一个方向上进行。这意味着它需要频繁切换传输方向，因此效率相对较低，但优点在于节省了传输线路资源。  
![X264_lookahead.jpeg](driverimages/93bf1defd666068b3a7b51022cb40e8e.png)

 同步通讯与异步通讯的概念  
同步通信，简而言之，就是在数据传输过程中，发送端会提供一个时钟信号，并遵循特定的约定（例如在时钟信号的上升沿发送数据）。接收端则根据这个时钟信号和共同约定来接收数据。这种通信方式常见于I2C、SPI等具有时钟信号的协议。

而异步通信则不同，接收方对数据的到达时间一无所知，收发双方各自拥有自己的时钟。发送方发送数据的时间间隔可能不均，而接收方则依赖数据的起始位和停止位来实现信息同步。这种传输方式通常以较小的数据分组进行，例如以一个字符为一组，并配备起始位和结束位。因此，异步通信的效率相对较低，但它在低速传输中较为常用。

接下来，我们进一步探讨同步通信与异步通信的区别：

（1）同步通信要求接收端和发送端的时钟频率保持一致，以确保连续的比特流传输；而异步通信则无需这种同步，发送端在发送完一个字节后，可以经过任意长的时间间隔再发送下一个字节。  
（2）在效率方面，同步通信通常高于异步通信。  
（3）从复杂性角度看，同步通信相对复杂，对双方时钟的误差要求较为严格；而异步通信则较为简单，允许双方时钟存在一定的误差。  
（4）此外，同步通信适用于点对多点的场景，而异步通信则主要适用于点对点的连接

# i2C

I2C协议是一种用于连接多个“从机”芯片和一个或多个“主机”芯片的通信协议。其设计类似于串行外设接口（SPI），同样适用于短距离通信场景。同时，它又与异步串行接口（如RS232或UART）相似，只需两根信号线即可实现信息交换。

在实现I2C通信时，两根信号线发挥着关键作用：SCL作为时钟信号线，而SDA则负责数据输入/输出。这种设计使得I2C通信既高效又便捷，且属于同步通信范畴，尽管其通信方向为半双工。总的来说，I2C协议以其短距离通信能力、一主多从的通信模式、半双工的通信方向以及仅需两根信号线的同步通信特点，成为了许多设备间通信的理想选择。

![X264_lookahead.jpeg](driverimages/i2c.png)

## I2C的高阻态

在I2C通信中，高阻态是一个关键概念。漏极开路（Open Drain）技术被用于实现这种状态，它允许设备独立地输出低电平和高阻态。若要产生高电平，则需要借助外部上拉电阻。

高阻状态是三态门电路的一种表现。除了高低电平，逻辑门的输出还可能处于高阻态，此时电路可被视为开路。在I2C系统中，所有设备都连接在同一条总线上。当某些设备进行通信时，其他空闲设备可能会受到总线干扰或干扰总线。为了维持总线的稳定，I2C规定空闲状态时必须由外部上拉电阻来控制，这将空闲设备置于高阻态，相当于断路状态。这样，只有开启的设备才会正常通信，从而确保不会干扰到其他设备。

## 数据传输协议

主设备和从设备之间进行数据传输时，必须遵循特定的协议格式。数据通过一条SDA数据线以串行方式传输0和1。串行数据的结构包括起始条件、数据传输、应答信号和停止条件等几个部分。  
1 开始位  
当主设备准备好启动通信时，它必须发送一个开始信号，并执行一系列操作来确保数据传输的顺利进行：

首先，将SDA数据线从高电平状态切换至低电平状态；  
随后，将SCL时钟线也从高电平切换至低电平状态。

一旦主设备发出这一开始条件信号，所有从设备，即便它们处于低功耗的睡眠模式，也会被唤醒并进入活动状态，准备接收地址信息。  
![](https://pic.rmb.bdstatic.com/bjh/news/5512acedceaabff48762aacd78a68554.png)  
2 地址位  
地址位在I2C通信中占据重要地位，它支持7bit和10bit两种格式。当主设备需要与从设备进行数据交换时，首先会发送该从设备的地址。随后，系统会核对总线上的从设备地址，以确保准确无误地识别不同设备。地址位由主设备发送，而从设备则负责接收并识别这一地址，以确认是否为自己的地址。

3 读写位  
由于I2C通信采用半双工模式，因此需要明确数据传输的方向。为此，协议中引入了读写位的概念。当主设备意图向从设备发送数据时，该位被设置为0；而当主设备需要从从设备接收数据时，则将其设置为1。读写位同样由主设备发送，以通知从设备相应的操作类型。

4 应答位  
I2C协议中还设计了一个独特的应答机制。在每个字节传输结束后，即第9个SCL时钟周期内，主机会释放SDA总线，将控制权交给从机。由于上拉电阻的作用，此时总线处于高电平状态。如果从机成功接收到主机发送的数据，它会通过将SDA拉低的方式来发出应答信号，表示已收到并准备进行下一步操作。  
5 非应答信号  
在I2C通信中，如果从设备在第9个SCL时钟周期时未能成功接收到主设备发送的数据，或者由于某种原因无法响应，那么它会选择不发出应答信号。这种情况下，SDA线将保持高电平状态，即SDA保持为1，从而表示一个非应答信号。这种设计使得主设备能够感知到从设备的响应状态，并据此采取相应的措施。  
![](https://pic.rmb.bdstatic.com/bjh/news/60441a026ef5992103556c1ab60e6d29.png)  
非应答信号的产生并非仅限于从机，主机在某些情况下也可能发出非应答信号。具体来说，产生非应答信号的情境包括：

I2C总线上不存在与主机所指定地址相匹配的从机设备；  
从机当前正忙于执行其他任务，尚未准备好与主机进行通信；  
主机发送的控制命令不被从机所支持；  
在主机接收从机数据的过程中，若数据已传输完毕，主机会发出非应答信号以通知从机停止发送数据。

此外，当SCL处于高电平状态时，SDA数据线上的数据必须保持稳定，以确保I2C数据总线的正常传输。因此，SDA上的数据变化只应在SCL为低电平时进行。  
在I2C通信中，每次传输的数据量为8位，这8位数据由发送方负责设置并传输给接收方。数据传输完毕后，会紧接着发送一个ACK（确认）或NACK（否认）信号。如果接收器成功接收到数据，那么从机会返回ACK信号；若接收失败，则从机会返回NACK信号。这一过程可以重复多次，直到接收到停止信号为止。

关于停止位的发送，当主设备决定结束通讯时，它需要执行以下操作：首先，将SDA数据线从低电压电平切换到高电压电平；紧接着，将SCL时钟线从高电平拉低至低电平。这样，就成功地发送了停止信号，标志着一次I2C通讯的结束。  
![](https://pic.rmb.bdstatic.com/bjh/news/e8984e1a4c43b8346aaa9894fd812f60.png)  
7 总结  
写寄存器的标准流程如下：  
Master首先发起START信号。  
接着，Master发送I2C地址（7位）和写操作位0（1位），并等待Slave的ACK信号。  
一旦收到Slave的ACK，Master继续发送寄存器地址（8位），并再次等待ACK。  
Slave再次发送ACK后，Master可以发送8位的数据到寄存器中，并等待最后的ACK信号。  
Slave确认无误后发送ACK，此时，第6步和第7步可以重复进行，以顺序写入多个寄存器。  
最后，Master发起STOP信号来结束写入过程。

读寄存器的流程则略有不同：  
Master同样发送I2C地址和写操作位0，但后续步骤有所不同。在Slave确认地址后，Master会先发起START信号，然后发送相同的I2C地址，但这次要带上读操作位1。Slave随后会发送8位的数据，即寄存器中的值。Master再发送ACK信号以确认接收。  
同样地，第8步和第9步也可以重复进行，以顺序读取多个寄存器的值。

## 仲裁机制

在多主设备的通信系统中，总线上可能存在多个节点，它们都拥有自己的寻址地址，并能作为从节点或主节点进行数据交换。然而，当两个或多个节点同时发送启动信号并开始数据传输时，就会产生冲突。为了解决这种冲突，I2C总线引入了仲裁机制。

I2C总线上的仲裁主要分为两部分：SCL线的同步和SDA线的仲裁。SCL线的同步依赖于总线的“与”逻辑功能，即当多个节点同时发送低电平时，总线表现为低电平；而只有当所有节点都发送高电平时，总线才表现为高电平。这种机制确保了当多个节点同时发送时钟信号时，总线上呈现的是统一的时钟信号，从而实现了SCL线的同步。  
![](https://pic.rmb.bdstatic.com/bjh/news/06fbe5be51df2d3e8a7e8018da2aa8e8.png)  
2 SDA线的仲裁

总线仲裁的目的是为了解决多设备在I2C总线上同时竞争控制权的问题。这一机制通过特定的逻辑判断，决定哪个设备能够获得总线的控制权。

SDA线的仲裁同样基于总线的“与”逻辑功能。在I2C通信过程中，每个节点在发送完1位数据后，会检查总线上呈现的数据是否与自己发送的一致。如果一致，则继续发送数据；如果不一致，则退出竞争。这种机制确保了I2C总线在多个主节点同时尝试控制时，仍能保持通信的稳定和数据的不丢失。通过仲裁，总线系统只允许一个主节点持续占据总线，从而保证了通信的有序进行。  
![](https://pic.rmb.bdstatic.com/bjh/news/bd2433ff91933c9b48bf7593b26e22da.png)  
![](https://pic.rmb.bdstatic.com/bjh/news/77a30af1bc5dc0f275cc39f5f4df9615.png)  
上图过程详解：  
在首个周期，所有设备均发送1，经过与运算后，结果仍为1，这与它们各自发送的数据相吻合，因此继续发送。

到了第二个周期，情况依旧，所有设备均发送1，与运算结果依旧为1，继续发送。

然而，在第三个周期，情况发生了变化。所有设备这次都发送了0，与运算后的结果自然也为0。由于这个结果与AB设备发送的数据不符，而与C设备发送的数据相吻合，因此AB设备选择退出竞争，节点C获得了胜利。

值得注意的是，SDA仲裁与SCL时钟同步处理是并行进行的，两者并无先后之分。

## I2C死锁现象

在实际应用中，I2C总线有时会遭遇死锁问题。死锁现象在I2C中具体表现为：SCL信号保持高电平，而SDA信号却一直处于低电平状态。

当I2C主设备开始读写操作时，它会控制SCL产生8个时钟脉冲，随后将SCL拉低。在此过程中，从设备应答并将SDA拉低。然而，若主设备在此刻异常复位，SCL将释放为高电平。若从设备未同步复位，则会继续保持I2C应答状态，使SDA持续处于低电平。

对于I2C主设备而言，复位后检测到SDA仍为低电平，会误认为总线仍被占用，并因此持续等待SCL和SDA变为高电平。这样，主设备和从设备便相互等待，I2C总线陷入死锁状态。

同样地，在进行I2C读操作时，若从设备应答后输出数据位为0，而在此刻主设备异常复位，也会导致I2C总线进入死锁状态。

## i2c linux驱动

在 Linux 内核中 I2C 的体系结构分为 3 个部分：

### I2C 核心：

I2C 核心提供了 I2C 总线驱动和设备驱动的注册、注销方法等。

### I2C 总线驱动：

I2C 总线驱动是对 I2C 硬件体系结构中适配器端的实现，适配器可由CPU控制，甚至可以直接集成在 CPU 内部。

一般是soc商家写好

I2C 总线驱动的本质也是一个标准的 platform 驱动框架，所以说I2C总线驱动是基于 platform 框架实现的，相当于又封装了一层

### I2C 设备驱动：

I2C 设备驱动是对 I2C 硬件体系结构中设备端的实现，设备一般挂接在受CPU控制的 I2C 适配器上，通过 I2C 适配器与 CPU 交换数据。

用户需要些的

# mipi

13850 3588驱动移植

https://download.csdn.net/blog/column/12021233/127621511

[RK3568驱动OV13850摄像头模组调试过程-CSDN博客](https://blog.csdn.net/fhqlongteng/article/details/129366781)

[关于RK3399平台OV13850摄像头调试的问题_rk平台pclk没有输出波形-CSDN博客](https://blog.csdn.net/weixin_58535525/article/details/119797772)

[瑞芯微RK3588 camera驱动总结三调试_瑞芯微驱动-CSDN博客](https://blog.csdn.net/huntenganwei/article/details/141787550)

[基于瑞芯微RV1109 Linux触摸屏GT911驱动调试心得_专栏_易百纳技术社区](https://www.ebaina.com/articles/140000016840)

[rk3568 | 瑞芯微平台GPIO引脚驱动编写 - 阿风小子 - 博客园](https://www.cnblogs.com/kn-zheng/p/17150775.html)

https://mp.weixin.qq.com/s?__biz=MzA3MjMzNTc4NA==&mid=2649006423&idx=1&sn=e91d75f1aa9939036315d858584400fc&chksm=8664e4418698172d54178d41666cdbff208c2c7b76b3b8b8c205935137d7880d4fb35b6bbf71#rd

DPHY:使用单独的时钟同步通道 

CPHY：没有时钟，带宽比DPHY更高

这两个都是mipi的物理层协议，

3588中cam1和cam2中csi和phy同时出现可能是考虑 ​

 Cam1（CSI+D-PHY）而cam2是单独D-PHY

csi ：输入

dsi  ：输出

# spi

# lvds

# pwm

（Pulse Width Modulation，脉冲宽度调制）

PWM（脉宽调制）通过调节占空比来控制功率开关器件的导通时间，最终实现输出电压的稳定，其核心原理是 **通过快速开关的周期性通断，控制能量的平均输出**。

1.     PWM的基本原理
    占空比（Duty Cycle：指一个周期内开关导通时间（高电平时间）与整个周期时间的比值。  
     公式：  
     占空比 = （导通时间\周期时间）*100% 
     开关频率：PWM信号的周期倒数（10Hz=表示每秒开关10次）。  
     频率越高，输出纹波越小，但开关损耗可能增加。
   
   2. 功率开关器件的导通控制
      功率开关器件（如MOSFET、IGBT）在导通时允许电流流过，截止时阻断电流。  
      通过PWM控制导通时间：  
      占空比大 → 导通时间长 → 平均输出电压高。  
      占空比小 → 导通时间短 → 平均输出电压低。  
      例如：  
      若输入电压为12V，占空比为50%，则平均输出电压约为6V。  
      占空比为75%时，平均输出电压约为9V。
   
   3. 如何实现“输出电压稳定”
      关键在于 闭环反馈控制，典型应用场景是开关电源（如BUCK、BOOST电路）：  
      步骤1：采样输出电压
      通过电阻分压或传感器实时监测输出电压Vout。  
      步骤2：与参考电压比较
      将采样电压与目标参考电压（Vref，如5V）输入误差放大器，生成误差信号。  
      步骤3：动态调整占空比
      若 Vout< Vref→ 增大占空比 → 导通时间延长 → 提升输出电压。  
      若 Vout > Vref→ 减小占空比 → 导通时间缩短 → 降低输出电压。  
      步骤4：周期性调节
      PWM控制器根据误差信号实时调整占空比，直到输出电压稳定在目标值。
   
   4. 举例说明（BUCK降压电路）
      输入电压Vin：24V  
      目标输出电压Vout：12V  
      理论占空比：  
      D = Vout/Vin = 12/24= 50% 
      实际运行：  
      当负载突然增大 → Vout下降 → 控制器检测到误差 → 占空比增大至55% → 输出恢复12V。  
      当输入电压波动（如24V→22V）→ 占空比自动调整至更高值（如55%）以补偿输入降低的影响

            应用：

1. ​**​电机控制​**​
   
   - ​**​调速原理​**​：改变PWM占空比可调节电机平均电压，占空比越大转速越高
     
     ​**​闭环控制​**​：结合速度反馈（如编码器）和PID算法，实现精准调速
   
   - 

2. ​**​LED调光​**​
   
   - 通过高频PWM（>80Hz）调节占空比，改变LED亮度，人眼感知为连续变化

3. ​**​电源转换​**​
   
   - ​**​DC-DC转换器​**​：通过调整占空比实现升压或降压，效率可达90%以上

4. ​**​音频与通信​**​
   
   - ​**​D类功放​**​：将音频信号编码为PWM波，经滤波还原为模拟信号
     
     ​**​信号传输​**​：PWM抗噪性强，适合远距离数字通信

# 差分信号
